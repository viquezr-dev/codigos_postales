<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PanamaCode - Sistema PlusCode con Base Personalizada</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1a2980, #26d0ce);
            color: #333;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }
        
        header {
            background: linear-gradient(135deg, #0052b4, #00a8ff);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        h1 {
            font-size: 2.8rem;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #fff, #ffeb3b);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        }
        
        .subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
            max-width: 600px;
            margin: 0 auto;
        }
        
        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            padding: 40px;
        }
        
        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }
        
        .control-panel {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 30px;
            border: 2px solid #e9ecef;
        }
        
        .result-panel {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 30px;
            border: 2px solid #e9ecef;
        }
        
        h2 {
            color: #0052b4;
            margin-bottom: 25px;
            padding-bottom: 10px;
            border-bottom: 3px solid #00a8ff;
            font-size: 1.8rem;
        }
        
        .input-group {
            margin-bottom: 25px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #495057;
            font-size: 1.1rem;
        }
        
        input, select {
            width: 100%;
            padding: 15px;
            border: 2px solid #ced4da;
            border-radius: 10px;
            font-size: 1.1rem;
            transition: all 0.3s;
        }
        
        input:focus, select:focus {
            outline: none;
            border-color: #00a8ff;
            box-shadow: 0 0 0 3px rgba(0, 168, 255, 0.2);
        }
        
        .coords-input {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        
        .base-selector {
            display: flex;
            gap: 15px;
            margin-top: 10px;
        }
        
        .base-option {
            flex: 1;
            text-align: center;
            padding: 15px;
            background: white;
            border: 2px solid #ced4da;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
        }
        
        .base-option:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .base-option.selected {
            background: #0052b4;
            color: white;
            border-color: #0052b4;
        }
        
        .button-group {
            display: flex;
            gap: 15px;
            margin-top: 30px;
        }
        
        button {
            flex: 1;
            padding: 18px;
            border: none;
            border-radius: 10px;
            font-size: 1.2rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #00a8ff, #0052b4);
            color: white;
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, #ff9a00, #ff5e00);
            color: white;
        }
        
        button:hover {
            transform: translateY(-3px);
            box-shadow: 0 7px 20px rgba(0, 0, 0, 0.2);
        }
        
        button:active {
            transform: translateY(-1px);
        }
        
        .code-display {
            background: white;
            border: 3px dashed #0052b4;
            border-radius: 15px;
            padding: 40px;
            text-align: center;
            margin-bottom: 30px;
        }
        
        .code {
            font-family: 'Courier New', monospace;
            font-size: 3rem;
            font-weight: bold;
            color: #0052b4;
            letter-spacing: 3px;
            margin: 20px 0;
            word-break: break-all;
        }
        
        .code-separator {
            color: #ff5e00;
            font-weight: 900;
            font-size: 4rem;
            line-height: 1;
        }
        
        .resolution-info {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 25px;
            border-left: 5px solid #00a8ff;
        }
        
        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        
        .info-item {
            text-align: center;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        
        .info-value {
            font-size: 1.8rem;
            font-weight: 700;
            color: #0052b4;
            margin: 5px 0;
        }
        
        .info-label {
            font-size: 0.9rem;
            color: #6c757d;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .map-container {
            height: 300px;
            background: linear-gradient(135deg, #e0f7fa, #80deea);
            border-radius: 15px;
            margin-top: 20px;
            position: relative;
            overflow: hidden;
        }
        
        .grid-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                linear-gradient(to right, rgba(0, 82, 180, 0.1) 1px, transparent 1px),
                linear-gradient(to bottom, rgba(0, 82, 180, 0.1) 1px, transparent 1px);
            background-size: 20px 20px;
        }
        
        .cell {
            position: absolute;
            background: rgba(255, 94, 0, 0.3);
            border: 2px solid #ff5e00;
            transition: all 0.3s;
        }
        
        .coordinates-display {
            font-family: 'Courier New', monospace;
            font-size: 1.2rem;
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            border-left: 5px solid #ff9a00;
            margin-top: 20px;
        }
        
        footer {
            text-align: center;
            padding: 25px;
            background: #f8f9fa;
            border-top: 2px solid #e9ecef;
            color: #6c757d;
            font-size: 0.9rem;
        }
        
        .feature-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }
        
        .feature {
            background: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }
        
        .feature-icon {
            font-size: 2.5rem;
            margin-bottom: 15px;
            color: #00a8ff;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üÖøÔ∏è PanamaCode</h1>
            <p class="subtitle">Sistema de geocodificaci√≥n similar a PlusCode con Base 30/36 - Optimizado para Panam√°</p>
        </header>
        
        <div class="main-content">
            <div class="control-panel">
                <h2>Configuraci√≥n</h2>
                
                <div class="input-group">
                    <label>Selecciona Base Num√©rica</label>
                    <div class="base-selector">
                        <div class="base-option selected" onclick="selectBase(30)">Base 30</div>
                        <div class="base-option" onclick="selectBase(36)">Base 36</div>
                    </div>
                    <small style="display:block; margin-top: 10px; color: #666;">
                        <strong>Base 30:</strong> 0123456789BCDFGHJKLMNPQRSTVWXYZ<br>
                        <strong>Base 36:</strong> 0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ
                    </small>
                </div>
                
                <div class="input-group">
                    <label>Coordenadas de Panam√°</label>
                    <div class="coords-input">
                        <div>
                            <label>Latitud (7.0¬∞ a 9.6¬∞)</label>
                            <input type="number" id="latitude" value="8.983333" step="0.000001" min="7.0" max="9.6">
                        </div>
                        <div>
                            <label>Longitud (-83.0¬∞ a -77.2¬∞)</label>
                            <input type="number" id="longitude" value="-79.516667" step="0.000001" min="-83.0" max="-77.2">
                        </div>
                    </div>
                </div>
                
                <div class="input-group">
                    <label>Precisi√≥n (caracteres)</label>
                    <select id="precision">
                        <option value="8">8 caracteres (‚âà 15m)</option>
                        <option value="10" selected>10 caracteres (‚âà 0.5m)</option>
                        <option value="12">12 caracteres (‚âà 1.6cm)</option>
                    </select>
                </div>
                
                <div class="input-group">
                    <label>Ubicaci√≥n de Ejemplo</label>
                    <select id="example-location" onchange="loadExample()">
                        <option value="">Selecciona una ubicaci√≥n...</option>
                        <option value="casco">Casco Viejo, Ciudad de Panam√°</option>
                        <option value="canal">Esclusas de Miraflores, Canal</option>
                        <option value="tocumen">Aeropuerto Tocumen</option>
                        <option value="boquete">Boquete, Chiriqu√≠</option>
                        <option value="sanblas">San Blas, Guna Yala</option>
                        <option value="david">David, Chiriqu√≠</option>
                        <option value="colon">Col√≥n, Zona Libre</option>
                        <option value="chitre">Chitr√©, Herrera</option>
                    </select>
                </div>
                
                <div class="button-group">
                    <button class="btn-primary" onclick="generateCode()">Generar C√≥digo</button>
                    <button class="btn-secondary" onclick="decodeCode()">Decodificar</button>
                </div>
            </div>
            
            <div class="result-panel">
                <h2>Resultado PanamaCode</h2>
                
                <div class="code-display">
                    <div style="color: #666; font-size: 1.1rem;">Tu c√≥digo PanamaCode:</div>
                    <div id="code-output" class="code">8F6CCQC5<span class="code-separator">+</span>8V</div>
                    <button onclick="copyToClipboard()" style="background: #28a745; color: white; padding: 10px 25px; border-radius: 5px; border: none; cursor: pointer;">
                        üìã Copiar C√≥digo
                    </button>
                </div>
                
                <div class="resolution-info">
                    <strong>Informaci√≥n de Precisi√≥n:</strong>
                    <div class="info-grid">
                        <div class="info-item">
                            <div class="info-label">Tama√±o de Celda</div>
                            <div id="cell-size" class="info-value">‚âà 14m √ó 14m</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Celdas en Panam√°</div>
                            <div id="total-cells" class="info-value">65.6M</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Prob. Colisi√≥n</div>
                            <div id="collision-prob" class="info-value">0.003%</div>
                        </div>
                    </div>
                </div>
                
                <div class="coordinates-display">
                    <strong>Coordenadas decodificadas:</strong><br>
                    <span id="decoded-coords">8.983333¬∞ N, 79.516667¬∞ W</span>
                </div>
                
                <div class="map-container">
                    <div class="grid-overlay"></div>
                    <div id="cell-highlight" class="cell"></div>
                </div>
            </div>
        </div>
        
        <div style="padding: 0 40px;">
            <h2>¬øC√≥mo funciona PanamaCode?</h2>
            <div class="feature-list">
                <div class="feature">
                    <div class="feature-icon">üî¢</div>
                    <h3>Base Personalizada</h3>
                    <p>Usa Base 30 o 36 en lugar de Base 20 del PlusCode est√°ndar</p>
                </div>
                <div class="feature">
                    <div class="feature-icon">üéØ</div>
                    <h3>Optimizado para Panam√°</h3>
                    <p>√Årea espec√≠fica: 7¬∞-10¬∞N, 77¬∞-83¬∞W para m√°xima eficiencia</p>
                </div>
                <div class="feature">
                    <div class="feature-icon">üìè</div>
                    <h3>Alta Precisi√≥n</h3>
                    <p>Hasta 1.6cm de precisi√≥n con 12 caracteres</p>
                </div>
                <div class="feature">
                    <div class="feature-icon">‚ö°</div>
                    <h3>Sin Colisiones</h3>
                    <p>Dise√±o jer√°rquico que evita c√≥digos duplicados</p>
                </div>
            </div>
        </div>
        
        <footer>
            <p>Sistema PanamaCode v1.0 - Similar a PlusCode/Open Location Code pero con Base 30/36</p>
            <p>¬© 2024 - Optimizado para la Rep√∫blica de Panam√°</p>
        </footer>
    </div>

    <script>
        // Variables globales
        let currentBase = 30;
        let alphabet30 = "0123456789BCDFGHJKLMNPQRSTVWXYZ";
        let alphabet36 = "0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ";
        
        // Mapa de ejemplos
        const examples = {
            "casco": { lat: 8.983333, lon: -79.516667, name: "Casco Viejo" },
            "canal": { lat: 8.994167, lon: -79.587222, name: "Esclusas de Miraflores" },
            "tocumen": { lat: 9.071667, lon: -79.383611, name: "Aeropuerto Tocumen" },
            "boquete": { lat: 8.775556, lon: -82.433056, name: "Boquete, Chiriqu√≠" },
            "sanblas": { lat: 9.566667, lon: -78.966667, name: "San Blas, Guna Yala" },
            "david": { lat: 8.433333, lon: -82.433333, name: "David, Chiriqu√≠" },
            "colon": { lat: 9.358611, lon: -79.901389, name: "Col√≥n, Zona Libre" },
            "chitre": { lat: 7.966667, lon: -80.433333, name: "Chitr√©, Herrera" }
        };
        
        // Inicializar
        document.addEventListener('DOMContentLoaded', function() {
            generateCode();
        });
        
        // Seleccionar base
        function selectBase(base) {
            currentBase = base;
            document.querySelectorAll('.base-option').forEach(el => {
                el.classList.remove('selected');
            });
            event.target.classList.add('selected');
            generateCode();
        }
        
        // Cargar ejemplo
        function loadExample() {
            const select = document.getElementById('example-location');
            const example = examples[select.value];
            if (example) {
                document.getElementById('latitude').value = example.lat;
                document.getElementById('longitude').value = example.lon;
                generateCode();
            }
        }
        
        // Generar c√≥digo PanamaCode
        function generateCode() {
            const lat = parseFloat(document.getElementById('latitude').value);
            const lon = parseFloat(document.getElementById('longitude').value);
            const precision = parseInt(document.getElementById('precision').value);
            
            // Validar coordenadas dentro de Panam√°
            if (lat < 7.0 || lat > 9.6 || lon < -83.0 || lon > -77.2) {
                alert("Coordenadas fuera de Panam√°. Usa: Lat 7.0-9.6¬∞, Lon -83.0 a -77.2¬∞");
                return;
            }
            
            // Normalizar para Panam√° (escala espec√≠fica)
            const panamaLatMin = 7.0;
            const panamaLatMax = 9.6;
            const panamaLonMin = -83.0;
            const panamaLonMax = -77.2;
            
            const latNorm = (lat - panamaLatMin) / (panamaLatMax - panamaLatMin);
            const lonNorm = (lon - panamaLonMin) / (panamaLonMax - panamaLonMin);
            
            // Convertir a c√≥digo (algoritmo similar a PlusCode)
            const code = encodePlusCodeStyle(latNorm, lonNorm, precision);
            
            // Mostrar resultado
            document.getElementById('code-output').innerHTML = 
                formatCode(code, precision) + 
                '<span class="code-separator">+</span>' + 
                code.substring(code.length - 2);
            
            // Actualizar informaci√≥n
            updateResolutionInfo(precision);
            
            // Actualizar mapa
            updateMapVisualization(lat, lon, precision);
            
            // Mostrar coordenadas
            document.getElementById('decoded-coords').textContent = 
                `${lat.toFixed(6)}¬∞ N, ${Math.abs(lon).toFixed(6)}¬∞ W`;
        }
        
        // Algoritmo de codificaci√≥n estilo PlusCode
        function encodePlusCodeStyle(latNorm, lonNorm, precision) {
            const alphabet = currentBase === 30 ? alphabet30 : alphabet36;
            const pairCount = Math.floor(precision / 2);
            
            let code = '';
            
            // Codificar pares (similar a PlusCode)
            for (let i = 0; i < pairCount; i++) {
                // Escalar y discretizar
                const latScaled = Math.floor(latNorm * Math.pow(currentBase, i + 1));
                const lonScaled = Math.floor(lonNorm * Math.pow(currentBase, i + 1));
                
                const latDigit = latScaled % currentBase;
                const lonDigit = lonScaled % currentBase;
                
                code += alphabet[latDigit] + alphabet[lonDigit];
            }
            
            return code;
        }
        
        // Formatear c√≥digo con separador
        function formatCode(code, precision) {
            if (precision <= 8) {
                return code.substring(0, 8);
            } else {
                return code.substring(0, 8) + code.substring(8, precision - 2);
            }
        }
        
        // Actualizar informaci√≥n de resoluci√≥n
        function updateResolutionInfo(precision) {
            const cellSize = calculateCellSize(precision);
            const totalCells = calculateTotalCells(precision);
            const collisionProb = calculateCollisionProbability(precision);
            
            document.getElementById('cell-size').textContent = `‚âà ${cellSize}m √ó ${cellSize}m`;
            document.getElementById('total-cells').textContent = formatNumber(totalCells);
            document.getElementById('collision-prob').textContent = `${collisionProb}%`;
        }
        
        // Calcular tama√±o de celda
        function calculateCellSize(precision) {
            const panamaWidth = 690000; // Ancho aproximado de Panam√° en metros
            const gridDivisions = Math.pow(currentBase, precision / 2);
            return Math.round(panamaWidth / gridDivisions);
        }
        
        // Calcular total de celdas
        function calculateTotalCells(precision) {
            return Math.pow(currentBase, precision);
        }
        
        // Calcular probabilidad de colisi√≥n
        function calculateCollisionProbability(precision) {
            const totalCells = calculateTotalCells(precision);
            const expectedPoints = 2000000; // 2M direcciones en Panam√°
            const probability = 1 - Math.exp(-Math.pow(expectedPoints, 2) / (2 * totalCells));
            return (probability * 100).toFixed(3);
        }
        
        // Formatear n√∫mero
        function formatNumber(num) {
            if (num >= 1e9) return (num / 1e9).toFixed(1) + 'B';
            if (num >= 1e6) return (num / 1e6).toFixed(1) + 'M';
            if (num >= 1e3) return (num / 1e3).toFixed(1) + 'K';
            return num.toString();
        }
        
        // Actualizar visualizaci√≥n del mapa
        function updateMapVisualization(lat, lon, precision) {
            const cell = document.getElementById('cell-highlight');
            const cellSize = calculateCellSize(precision);
            
            // Calcular posici√≥n relativa en Panam√°
            const panamaLatMin = 7.0;
            const panamaLatMax = 9.6;
            const panamaLonMin = -83.0;
            const panamaLonMax = -77.2;
            
            const latPercent = (lat - panamaLatMin) / (panamaLatMax - panamaLatMin);
            const lonPercent = (lon - panamaLonMin) / (panamaLonMax - panamaLonMin);
            
            // Posicionar celda en el contenedor
            const containerSize = 300; // px
            const cellSizePx = Math.max(10, containerSize / Math.pow(currentBase, precision / 4));
            
            cell.style.width = cellSizePx + 'px';
            cell.style.height = cellSizePx + 'px';
            cell.style.left = (lonPercent * 100) + '%';
            cell.style.top = ((1 - latPercent) * 100) + '%';
            cell.style.transform = 'translate(-50%, -50%)';
        }
        
        // Decodificar c√≥digo
        function decodeCode() {
            const codeInput = prompt("Ingresa un c√≥digo PanamaCode para decodificar:", 
                                   document.getElementById('code-output').textContent.replace('+', ''));
            
            if (!codeInput) return;
            
            // Eliminar separador si existe
            const cleanCode = codeInput.replace('+', '').toUpperCase();
            
            // Decodificar (algoritmo inverso)
            const decoded = decodePlusCodeStyle(cleanCode);
            
            if (decoded) {
                document.getElementById('latitude').value = decoded.lat.toFixed(6);
                document.getElementById('longitude').value = decoded.lon.toFixed(6);
                generateCode();
            } else {
                alert("C√≥digo inv√°lido. Aseg√∫rate de usar solo caracteres v√°lidos.");
            }
        }
        
        // Algoritmo de decodificaci√≥n
        function decodePlusCodeStyle(code) {
            const alphabet = currentBase === 30 ? alphabet30 : alphabet36;
            
            let latNorm = 0;
            let lonNorm = 0;
            let divisor = 1;
            
            // Decodificar caracteres en pares
            for (let i = 0; i < code.length; i += 2) {
                if (i + 1 >= code.length) break;
                
                const latChar = code[i];
                const lonChar = code[i + 1];
                
                const latIdx = alphabet.indexOf(latChar);
                const lonIdx = alphabet.indexOf(lonChar);
                
                if (latIdx === -1 || lonIdx === -1) return null;
                
                latNorm += latIdx / divisor;
                lonNorm += lonIdx / divisor;
                
                divisor *= currentBase;
            }
            
            // Escalar de vuelta a coordenadas de Panam√°
            const panamaLatMin = 7.0;
            const panamaLatMax = 9.6;
            const panamaLonMin = -83.0;
            const panamaLonMax = -77.2;
            
            const lat = panamaLatMin + latNorm / divisor * (panamaLatMax - panamaLatMin);
            const lon = panamaLonMin + lonNorm / divisor * (panamaLonMax - panamaLonMin);
            
            return { lat, lon };
        }
        
        // Copiar al portapapeles
        function copyToClipboard() {
            const code = document.getElementById('code-output').textContent;
            navigator.clipboard.writeText(code).then(() => {
                alert("C√≥digo copiado al portapapeles: " + code);
            });
        }
    </script>
</body>
</html>
